# Parth's Submission: Bayesian Health-Music Catalog API

Hi! This is my submission for the take home assignment in regards to the creation of an API that lets users create an artist, create an album, submit ratings, as well as lookup the artist/albums. For this exercise, I chose FastAPI+ Uvicorn as my framework of choice due to it's simplicity, autogenerated documentation using Swagger (which you can test by going to the /docs endpoint and submitting queries) and overall robustness in terms of type checking and schema validation. I chose SQLite for the database, and pytest for unit tests. 

## Code Overview

### `app/`

Contains the application code.

-   **`main.py`**: The main FastAPI application file where API endpoints are defined.
-   **`crud.py`**: Contains functions for Create, Read, Update, Delete operations.
-   **`database.py`**: Handles database connections and utilities.
-   **`schemas.py`**: Contains Pydantic models for data validation and serialization.
-   **`__init__.py`**: An empty file indicating that `app` is a Python package.

### `tests/`

Contains test cases.

-   **`test_main.py`**: Contains unit tests for the application.
-   **`__init__.py`**: An empty file indicating that `tests` is a Python package.

### Root Files

-   **`init_db.py`**: Script to initialize the database using `schema.sql`.
-   **`schema.sql`**: SQL commands to create the database schema.
-   **`requirements.txt`**: Lists all Python dependencies.

# Installation/Setup

## Prerequisites

1. Python 3.8 or higher
2. pip 

## Clone the Repo

    git clone https://github.com/yourusername/bayesian-music-catalog.git
    cd music-catalog-fastapi


## Create the Virtual Env

    python3 -m venv venv
    source venv/bin/activate  # On Windows: venv\Scripts\activate


## Install Dependencies

    pip install -r requirements.txt


## Initialize the Database

For this exercise I chose to use SQLite as the database for it's simplicity as a file based database

    python init_db.py



# Running the Backend App

Start the application using Uvicorn:

    uvicorn app.main:app --reload


The API will be accessible at http://127.0.0.1/8000/
### Access API Documentation

-   **Swagger UI**: http://127.0.0.1:8000/docs

## API Endpoints

### 1. Create an Artist

-   **Endpoint**: `/artists`
    
-   **Method**: `POST`
    
-   **Request Body**:

    `{
      "name": "Artist Name"
    }`
- **Response**:
`{
  "id": 1,
  "name": "Artist Name"
}`

### 2. Create an Album

-   **Endpoint**: `/albums`
    
-   **Method**: `POST`
    
-   **Request Body**:
`{
  "artist_name": "Artist Name",
  "name": "Album Name",
  "release_date": "YYYY-MM-DD",
  "price": 9.99
}`
- **Response**:
`{
  "id": 1,
  "artist_id": 1,
  "artist_name": "Artist Name",
  "name": "Album Name",
  "release_date": "YYYY-MM-DD",
  "price": 9.99,
  "average_rating": 0.0
}
`
### 3. Submit a Rating

-   **Endpoint**: `/albums/ratings`
    
-   **Method**: `POST`
    
-   **Request Body**:
`{
  "album_name": "Album Name",
  "rating": 5
}
`
- **Response**:
`{
  "album_id": 1,
  "average_rating": 4.5
}
`
### 4. Search

-   **Endpoint**: `/search`
    
-   **Method**: `GET`
    
-   **Query Parameter**: `q` (e.g., `/search?q=Artist+Name`)
    
**Response**:

-   **If an artist is found**:
	- `{
  "id": 1,
  "name": "Artist Name",
  "albums": [
    {
      "id": 1,
      "name": "Album Name",
      "release_date": "YYYY-MM-DD",
      "price": 9.99,
      "average_rating": 4.5
    }
  ]
}
`

- **If an album is found**:
- `{
  "albums": [
    {
      "id": 1,
      "artist_id": 1,
      "artist_name": "Artist Name",
      "name": "Album Name",
      "release_date": "YYYY-MM-DD",
      "price": 9.99,
      "average_rating": 4.5
    }
  ]
}
`
## Running Tests

### Prerequisites

Ensure all dependencies are installed. Then execute the following command from the project's **root** directory:

    python -m unittest discover

**Expected Output:**
.......
----------------------------------------------------------------------
Ran 7 tests in 0.XXXs

OK

### Test Coverage

The tests cover:

-   Creating artists and albums.
-   Submitting ratings.
-   Searching for artists and albums.
-   Handling error cases.

### Features

-   **Case-Insensitive Matching**: Searches are case-insensitive for better user experience.
-   **Handling Duplicates**: If multiple albums have the same name, the API prompts for more specific information.
-   **Error Handling**: Appropriate HTTP status codes and error messages guide the user.



